<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proportional Representation of Tree Measurements</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the visualization */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        
        /* Wood Grain Effect using CSS Gradients */
        .woodgrain {
            background-color: var(--wood-color);
            background-image: repeating-linear-gradient(
                45deg, rgba(0, 0, 0, 0.05) 0, rgba(0, 0, 0, 0.05) 1px, transparent 1px, transparent 10px
            ), repeating-linear-gradient(
                135deg, rgba(255, 255, 255, 0.08) 0, rgba(255, 255, 255, 0.08) 2px, transparent 2px, transparent 5px
            );
            background-size: 10px 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .tree-circle {
            transition: all 0.3s ease-in-out;
            cursor: default;
            flex-shrink: 0;
            border: 2px solid rgba(0, 0, 0, 0.2);
        }
        .tree-circle:hover {
            box-shadow: 0 8px 12px -3px rgba(0, 0, 0, 0.25), 0 3px 5px -2px rgba(0, 0, 0, 0.04);
            transform: scale(1.04);
        }
        .circumference-line {
            transition: width 0.3s ease-in-out;
        }
        /* Fixed max width for consistent proportional line comparison */
        .girth-comparison-container {
            width: 100%;
            max-width: 250px;
        }
        
        /* Height Bar Container: Fixed size, relative position for inner elements */
        .height-bar-container {
            width: 70px; /* Reduced width for bar only */
            height: 150px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: visible; /* Allow labels to overflow */
            position: relative; 
            padding: 2px; /* Defines the drawing margin (146px height area) */
            margin-left: auto;
        }
        
        /* --- Ruler Styling --- */
        .ruler-tick-line {
            width: 10px; /* Longer ticks */
            height: 2px;
            background-color: #9ca3af;
            position: absolute;
            right: 2px; 
            /* Centers the 1px line vertically on the 'bottom' position */
            transform: translateY(50%); 
        }
        .ruler-label {
            position: absolute;
            right: 18px; /* Move label out further */
            font-size: 10px;
            color: #4b5563;
            line-height: 1; /* Better centering control for text */
            /* Centers the text vertically on the 'bottom' position */
            transform: translateY(50%); 
        }

        /* Strong Line at 0 meters for the Ground/Base */
        .ground-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background-color: #374151; /* Dark gray */
            z-index: 100;
        }
        
        /* --- Measurement Styling (Updated for range markers only) --- */
        
        /* Style for the range markers (Min and Max) - Solid Line */
        .height-range-marker {
            position: absolute;
            background-color: transparent; 
            border-top: 3px solid; /* Strong solid line */
            width: 90%; 
            height: 3px;
            left: 50%;
            /* Centers the line vertically on the 'bottom' position */
            transform: translate(-50%, 50%); 
            z-index: 10;
            transition: all 0.3s ease-in-out;
            border-radius: 1px;
        }
    </style>
</head>
<body class="p-4 md:p-8 lg:p-12">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-2">Proportional Representation of Tree Measurements</h1>
            <p class="text-lg text-gray-600">A proportional visualization of DBH, Girth, and estimated height for each sample.</p>
            <div class="mt-3 text-sm text-gray-500 italic">($C = D \times \pi$)</div>
        </header>

        <main id="visualization-container" class="space-y-8">
            <!-- Content will be injected by JavaScript -->
        </main>

        <div class="mt-16 pt-8 border-t border-gray-200 text-center">
            <p class="text-sm text-gray-500">Visualization powered by JavaScript scaling logic.</p>
        </div>
    </div>

    <script>
        // --- Visualization Logic ---
        const treeData = [
            // Data provided by the user (Girth in cm), and calculated heights
            { type: "Douglas Fir", girth: 340, site: "Site Two", condition: "6/9", height_min: 40, height_max: 60 },
            { type: "Douglas Fir", girth: 313, site: "Site Two", condition: "6/9", height_min: 35, height_max: 55 },
            { type: "Douglas Fir", girth: 326, site: "Site Two", condition: "6/9", height_min: 38, height_max: 58 },
            { type: "Cedar", girth: 258, site: "Site Two", condition: "5/9", height_min: 18, height_max: 35 },
            { type: "Cedar", girth: 421, site: "Site Two", condition: "5/9", height_min: 30, height_max: 50 },
            { type: "Cedar", girth: 451, site: "Site One", condition: "8/9", height_min: 35, height_max: 55 },
            { type: "Douglas Fir", girth: 373, site: "Site One", condition: "7/9", height_min: 45, height_max: 65 },
            { type: "Douglas Fir", girth: 23, site: "Site One", condition: "6/9", height_min: 4, height_max: 8 },
        ];

        const PI = Math.PI;
        const MAX_VISUAL_SIZE = 180; // Max diameter size for the circle (in pixels) - slightly increased
        const MAX_CONTAINER_HEIGHT = 150; // Total height of the container (with padding)
        const CONTAINER_PADDING = 2; 
        // Max visual height of the drawing area (150 - 4 = 146px)
        const MAX_HEIGHT_VISUAL = MAX_CONTAINER_HEIGHT - (CONTAINER_PADDING * 2); 
        
        // Realistic wood tones and corresponding card colors
        const typeColors = {
            'Douglas Fir': { baseColor: '#8D4C3A', text: 'text-red-900', lightBg: 'bg-red-50', hover: 'hover:bg-red-100', icon: 'ðŸŒ²', heightColor: '#14532d' },
            'Cedar': { baseColor: '#B6886A', text: 'text-amber-800', lightBg: 'bg-amber-100', hover: 'hover:bg-amber-200', icon: 'ðŸŒ³', heightColor: '#533a14' }
        };

        // 1. Calculate DBH, Average Height, and find the overall Max Diameter/Height
        let maxDiameter = 0;
        let maxHeight = 0;
        treeData.forEach(tree => {
            tree.diameter = tree.girth / PI; 
            tree.height_avg = (tree.height_min + tree.height_max) / 2;
            
            if (tree.diameter > maxDiameter) {
                maxDiameter = tree.diameter;
            }
            if (tree.height_max > maxHeight) {
                maxHeight = tree.height_max;
            }
        });

        const maxCircumference = maxDiameter * PI;
        
        // 2. Set Scaling Factors
        const diameterScaleFactor = MAX_VISUAL_SIZE / maxDiameter;
        
        const MAX_COMPARISON_WIDTH = 250;
        const circumferenceScaleFactor = MAX_COMPARISON_WIDTH / maxCircumference;

        // Scale factor: pixels per meter
        const heightScaleFactor = MAX_HEIGHT_VISUAL / maxHeight;


        /**
         * Determines the Tailwind color class based on the condition score.
         */
        function getConditionColor(scoreString) {
            try {
                const score = (scoreString.includes('/')) ? parseInt(scoreString.split('/')[0]) : parseInt(scoreString);
                if (score >= 8) {
                    return 'text-green-600'; // Excellent
                } else if (score >= 6) {
                    return 'text-amber-600'; // Good
                } else {
                    return 'text-red-600'; // Fair/Poor
                }
            } catch (e) {
                console.error("Invalid condition score format:", scoreString, e);
                return 'text-gray-500';
            }
        }


        /**
         * Renders the tree data visualization into the DOM, grouped by site.
         */
        function renderTrees() {
            const container = document.getElementById('visualization-container');
            if (!container) return;
            container.innerHTML = ''; 

            // Group data by SITE
            const groupedData = treeData.reduce((acc, tree) => {
                const siteName = tree.site || "Ungrouped";
                if (!acc[siteName]) {
                    acc[siteName] = [];
                }
                acc[siteName].push(tree);
                return acc;
            }, {});

            const siteHeaderColors = {
                'Site One': 'text-indigo-700',
                'Site Two': 'text-blue-700',
            }
            const siteOrder = ['Site One', 'Site Two'];

            siteOrder.forEach(siteName => {
                const trees = groupedData[siteName];
                if (!trees || trees.length === 0) return;

                const group = document.createElement('div');
                group.className = 'p-5 sm:p-6 bg-white rounded-2xl shadow-xl';

                const headerColorClass = siteHeaderColors[siteName] || 'text-gray-800';
                
                group.innerHTML = `<h2 class="text-2xl font-bold mb-6 ${headerColorClass} border-b border-current pb-2">${siteName} Samples</h2>`;

                // Increased gap from gap-6 to gap-8
                const treeGrid = document.createElement('div');
                treeGrid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8'; 

                trees.forEach((tree, index) => {
                    const colors = typeColors[tree.type];

                    const visualDiameter = tree.diameter * diameterScaleFactor;
                    const visualCircumference = tree.girth * circumferenceScaleFactor;
                    
                    // Scaled heights from the base (0m). 
                    const visualHeightMin = tree.height_min * heightScaleFactor;
                    const visualHeightMax = tree.height_max * heightScaleFactor;
                    
                    const diameter = tree.diameter.toFixed(1);
                    const circumference = tree.girth.toFixed(1);
                    const conditionColor = getConditionColor(tree.condition);

                    const treeCard = document.createElement('div');
                    treeCard.className = `flex flex-col p-4 ${colors.lightBg} rounded-xl shadow-lg transition duration-300 transform ${colors.hover} hover:shadow-xl`;
                    
                    
                    // --- Top Row: Circle (DBH) and Height Visualization ---
                    const topRow = document.createElement('div');
                    topRow.className = 'flex flex-row items-start mb-3';
                    
                    // 1. Circle Container (Diameter, D) - DBH visualization
                    const circleContainer = document.createElement('div');
                    circleContainer.className = 'flex items-center justify-center flex-shrink-0 mr-4';
                    // Slightly adjusted for better centering
                    circleContainer.style.width = `${MAX_VISUAL_SIZE/2}px`; 
                    circleContainer.style.height = `${MAX_VISUAL_SIZE/2}px`;

                    const circle = document.createElement('div');
                    circle.className = `tree-circle woodgrain rounded-full flex items-center justify-center shadow-md`;
                    circle.style.cssText = `--wood-color: ${colors.baseColor}; width: ${visualDiameter / 2}px; height: ${visualDiameter / 2}px; min-width: 15px; min-height: 15px;`;
                    
                    circle.innerHTML = ''; 
                    circleContainer.appendChild(circle);
                    
                    // 2. Info: Name, DBH, Condition
                    const infoBlock = document.createElement('div');
                    infoBlock.className = 'flex flex-col flex-grow min-w-0';
                    infoBlock.innerHTML = `
                        <p class="text-sm font-bold ${colors.text} truncate">${colors.icon} ${tree.type} #${index + 1}</p>
                        <p class="text-xs text-gray-600">DBH (D): ${diameter} cm</p>
                        <p class="text-xs font-semibold ${conditionColor}">Condition: ${tree.condition}</p>
                        <p class="text-xs font-semibold text-gray-800 mt-2">
                            Avg. Height: ${tree.height_avg.toFixed(1)} m
                        </p>
                    `;
                    
                    topRow.appendChild(circleContainer);
                    topRow.appendChild(infoBlock);

                    // 3. Height Visualization (Vertical Bar & Ruler)
                    const heightBlock = document.createElement('div');
                    heightBlock.className = 'flex flex-col items-center flex-shrink-0 ml-4';
                    
                    const heightViz = document.createElement('div');
                    heightViz.className = 'height-bar-container';

                    // --- Build Ruler Ticks ---
                    let rulerHtml = '';
                    // CHANGED: Ticks every 5 meters for a finer scale
                    const tickInterval = 5; 
                    
                    // Create ticks from 0m up to the max height
                    // We step by the interval (5m) and stop if the step exceeds the overall maxHeight (65m)
                    for (let m = 0; m <= maxHeight; m += tickInterval) {
                        const visualTickPosition = m * heightScaleFactor;
                        
                        // Stop drawing ticks if they exceed the visual area
                        if (visualTickPosition > MAX_HEIGHT_VISUAL) continue;

                        // Ruler tick line (centers the line vertically on the 'bottom' position)
                        // Only display the label every 10 meters for less clutter
                        const isMajorTick = (m % 10 === 0);
                        const tickWidth = isMajorTick ? '10px' : '5px';
                        const labelHtml = isMajorTick ? `<span 
                                class="ruler-label" 
                                style="bottom: ${visualTickPosition}px;">${m}m</span>` : '';

                        rulerHtml += `
                            <div 
                                class="ruler-tick-line" 
                                style="bottom: ${visualTickPosition}px; width: ${tickWidth};">
                            </div>
                            ${labelHtml}
                        `;
                    }
                    // --- End Ruler Ticks ---

                    // Elements are centered and positioned correctly from the bottom (0px is the base line)
                    heightViz.innerHTML = `
                        <div class="relative w-full h-full">
                            
                            ${rulerHtml}
                            
                            <!-- Min Height Marker (Orange) -->
                            <div 
                                class="height-range-marker" 
                                style="bottom: ${visualHeightMin}px; border-top-color: #f97316;">
                            </div>
                            <!-- Min Height Label -->
                            <span 
                                class="absolute right-[78px] text-[9px] font-bold text-orange-600 w-[50px] text-right" 
                                style="bottom: ${visualHeightMin}px; transform: translateY(50%);">
                                ${tree.height_min}m (Min)
                            </span>


                            <!-- Max Height Marker (Emerald) -->
                            <div 
                                class="height-range-marker" 
                                style="bottom: ${visualHeightMax}px; border-top-color: #10b981;">
                            </div>
                            <!-- Max Height Label -->
                            <span 
                                class="absolute right-[78px] text-[9px] font-bold text-emerald-600 w-[50px] text-right" 
                                style="bottom: ${visualHeightMax}px; transform: translateY(50%);">
                                ${tree.height_max}m (Max)
                            </span>

                            <!-- GROUND LINE (The 0m Reference) -->
                            <div class="ground-line"></div>
                        </div>
                    `;

                    heightBlock.appendChild(heightViz);
                    topRow.appendChild(heightBlock);
                    
                    // --- Circumference Line (Girth, C) ---
                    const circumferenceBlock = document.createElement('div');
                    circumferenceBlock.className = 'w-full flex flex-col items-start pt-2 border-t border-gray-200 mb-1';
                    
                    const comparisonContainer = document.createElement('div');
                    comparisonContainer.className = 'girth-comparison-container h-3 bg-gray-300 rounded-full relative overflow-hidden my-1';

                    const circumferenceLine = document.createElement('div');
                    circumferenceLine.className = 'circumference-line bg-gray-900 h-full absolute top-0 left-0';
                    circumferenceLine.style.width = `${visualCircumference}px`;
                    
                    comparisonContainer.appendChild(circumferenceLine);

                    const circumferenceLabel = document.createElement('p');
                    circumferenceLabel.className = `text-[11px] font-semibold text-gray-700 mt-1`;
                    circumferenceLabel.innerHTML = `Girth (C): ${circumference} cm`; 
                    
                    circumferenceBlock.appendChild(comparisonContainer);
                    circumferenceBlock.appendChild(circumferenceLabel);


                    // --- Assemble Card ---
                    treeCard.appendChild(topRow);
                    treeCard.appendChild(circumferenceBlock);

                    treeGrid.appendChild(treeCard);
                });

                group.appendChild(treeGrid);
                container.appendChild(group);
            });
        }

        // Run the rendering when the document is fully loaded
        document.addEventListener('DOMContentLoaded', renderTrees);
    </script>
</body>
</html>
